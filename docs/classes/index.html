<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hytale API - All Classes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/javadoc-style.css">
    <style>
        body { background: #1a1f2e; color: #e8e9ed; min-height: 100vh; }
        .search-container { max-width: 800px; margin: 40px auto; padding: 0 20px; }
        .search-box {
            background: #252b3d;
            border: 2px solid #2d3548;
            color: #e8e9ed;
            padding: 15px 20px;
            font-size: 18px;
            border-radius: 8px;
            width: 100%;
        }
        .search-box:focus { border-color: #A3B50B; outline: none; box-shadow: 0 0 0 3px rgba(163, 181, 11, 0.1); }
        .header { text-align: center; padding: 60px 20px 20px; }
        .header h1 { color: #e8e9ed; margin-bottom: 10px; }
        .header p { color: #a8adb8; font-size: 18px; }
        .stats { text-align: center; color: #6c717d; margin-top: 15px; font-size: 14px; }

        /* Package tree */
        .package-tree { max-width: 1200px; margin: 40px auto; padding: 20px; }
        .package-node { margin-bottom: 8px; }
        .package-header {
            background: #252b3d;
            border: 1px solid #2d3548;
            padding: 12px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            user-select: none;
        }
        .package-header:hover { border-color: #A3B50B; background: #2d3548; }
        .package-chevron {
            display: inline-block;
            transition: transform 0.2s;
            margin-right: 8px;
            color: #A3B50B;
            font-weight: bold;
        }
        .package-node.collapsed .package-chevron { transform: rotate(-90deg); }
        .package-name-text {
            color: #A3B50B;
            font-weight: 600;
            font-size: 15px;
        }
        .package-count {
            color: #6c717d;
            font-size: 13px;
            margin-left: 10px;
        }
        .package-classes {
            margin-left: 24px;
            margin-top: 8px;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .package-node.collapsed .package-classes { max-height: 0 !important; }
        .class-link-item {
            display: block;
            color: #a8adb8;
            text-decoration: none;
            padding: 8px 16px;
            margin: 2px 0;
            border-radius: 4px;
            transition: all 0.15s;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .class-link-item:hover {
            color: #e8e9ed;
            background: #252b3d;
            padding-left: 20px;
        }
        .expand-all-btn {
            background: #252b3d;
            border: 2px solid #A3B50B;
            color: #A3B50B;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            margin-left: 10px;
        }
        .expand-all-btn:hover {
            background: #2d3548;
            color: #e8e9ed;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Hytale Plugin API Documentation</h1>
        <p>Complete API Reference - 4,735 Classes</p>
    </div>

    <div class="search-container">
        <input type="text" id="searchBox" class="search-box" placeholder="Search classes or packages..." autofocus>
        <div class="stats">
            <span id="stats">Loading package tree...</span>
            <button id="expandAll" class="expand-all-btn" style="display: none;">Expand All</button>
            <button id="collapseAll" class="expand-all-btn" style="display: none;">Collapse All</button>
        </div>
    </div>

    <div id="packageTree" class="package-tree"></div>

    <script>
        let searchIndex = [];
        let packageTree = {};
        let allPackages = [];

        // Load search index and build tree
        fetch('../assets/search-index.json')
            .then(response => response.json())
            .then(data => {
                searchIndex = data;
                buildPackageTree();
                renderPackageTree();

                // Show expand/collapse buttons
                document.getElementById('expandAll').style.display = 'inline-block';
                document.getElementById('collapseAll').style.display = 'inline-block';
            })
            .catch(err => {
                document.getElementById('stats').textContent = 'Failed to load class index';
                console.error('Failed to load search index:', err);
            });

        function buildPackageTree() {
            // Group classes by package
            const classes = searchIndex.filter(e => e.type === 'class');

            classes.forEach(classEntry => {
                const pkg = classEntry.package || 'default';
                if (!packageTree[pkg]) {
                    packageTree[pkg] = [];
                }
                packageTree[pkg].push(classEntry);
            });

            // Sort classes within each package
            Object.keys(packageTree).forEach(pkg => {
                packageTree[pkg].sort((a, b) => a.name.localeCompare(b.name));
            });

            // Get sorted package list
            allPackages = Object.keys(packageTree).sort();
        }

        function renderPackageTree(filter = '') {
            const container = document.getElementById('packageTree');
            const lowerFilter = filter.toLowerCase();

            if (filter) {
                // Search mode: show matching classes
                const matchingClasses = searchIndex.filter(e => {
                    if (e.type !== 'class') return false;
                    return e.name.toLowerCase().includes(lowerFilter) ||
                           (e.package && e.package.toLowerCase().includes(lowerFilter));
                });

                if (matchingClasses.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #6c717d; padding: 40px;">No classes found</div>';
                    document.getElementById('stats').textContent = 'No results';
                    return;
                }

                container.innerHTML = matchingClasses.map(classEntry => {
                    // Fix path: remove 'classes/' prefix since we're already in /classes/
                    const fixedPath = classEntry.file.replace('classes/', '');
                    return `<a href="${fixedPath}" class="class-link-item">${classEntry.name}<span style="color: #6c717d; font-size: 12px; margin-left: 8px;">${classEntry.package || ''}</span></a>`;
                }).join('');

                document.getElementById('stats').textContent = `${matchingClasses.length} matching classes`;
            } else {
                // Tree mode: show full package hierarchy
                let totalClasses = 0;
                container.innerHTML = allPackages.map(pkg => {
                    const classes = packageTree[pkg];
                    totalClasses += classes.length;

                    const classesHtml = classes.map(c => {
                        // Fix path: remove 'classes/' prefix since we're already in /classes/
                        const fixedPath = c.file.replace('classes/', '');
                        return `<a href="${fixedPath}" class="class-link-item">${c.name}</a>`;
                    }).join('');

                    return `
                        <div class="package-node collapsed">
                            <div class="package-header" onclick="togglePackage(this)">
                                <span class="package-chevron">â–¼</span>
                                <span class="package-name-text">${pkg}</span>
                                <span class="package-count">(${classes.length} classes)</span>
                            </div>
                            <div class="package-classes" style="max-height: 0;">${classesHtml}</div>
                        </div>
                    `;
                }).join('');

                document.getElementById('stats').textContent = `${allPackages.length} packages, ${totalClasses} classes`;
            }
        }

        function togglePackage(header) {
            const node = header.closest('.package-node');
            const classes = node.querySelector('.package-classes');

            if (node.classList.contains('collapsed')) {
                node.classList.remove('collapsed');
                classes.style.maxHeight = classes.scrollHeight + 'px';
            } else {
                node.classList.add('collapsed');
                classes.style.maxHeight = '0';
            }
        }

        // Search functionality
        let searchTimeout;
        document.getElementById('searchBox').addEventListener('input', function(e) {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                renderPackageTree(e.target.value.trim());
            }, 200);
        });

        // Expand/collapse all
        document.getElementById('expandAll').addEventListener('click', function() {
            document.querySelectorAll('.package-node').forEach(node => {
                node.classList.remove('collapsed');
                const classes = node.querySelector('.package-classes');
                classes.style.maxHeight = classes.scrollHeight + 'px';
            });
        });

        document.getElementById('collapseAll').addEventListener('click', function() {
            document.querySelectorAll('.package-node').forEach(node => {
                node.classList.add('collapsed');
                const classes = node.querySelector('.package-classes');
                classes.style.maxHeight = '0';
            });
        });

        // Handle URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const query = urlParams.get('q');
        const packageFilter = urlParams.get('package');

        if (query || packageFilter) {
            document.getElementById('searchBox').value = query || packageFilter;
        }
    </script>
</body>
</html>
